var t={};class e{static GAME_STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=e.GAME_STATUS.idle,this.score=0,this.initialState=t,this.state=t.map(t=>[...t])}getState(){return this.state}getScore(){return this.score}getStatus(){return this.status}start(){this.status=e.GAME_STATUS.playing,this.state=this.initialState.map(t=>[...t]),this.addCell(),this.addCell(),this.updateUI()}restart(){this.score=0,this.status=e.GAME_STATUS.idle,this.state=this.initialState.map(t=>[...t]),this.updateUI()}move(t,s,a){if(this.getStatus()!==e.GAME_STATUS.playing)return!1;let r=!1,i=t(s(this.state).map(t=>{let e=t.filter(t=>0!==t),s=[];for(let t=0;t<e.length;t++)if(e[t]===e[t+1]){let a=2*e[t];s.push(a),this.score+=a,t++,r=!0}else s.push(e[t]);for(;s.length<t.length;)s.push(0);return r||t.every((t,e)=>t===s[e])||(r=!0),s}));return a?this.areStatesEqual(this.state,i)||(r=!0,this.state=i,this.addCell(),this.updateUI(),this.checkStatus()):this.areStatesEqual(s(this.state),i)||(r=!0,this.state=i,this.addCell(),this.updateUI(),this.checkStatus()),r}moveLeft(){return this.move(t=>t,t=>t,!1)}moveRight(){return this.move(t=>t.map(t=>t.reverse()),t=>t.map(t=>t.reverse()),!1)}moveUp(){return this.move(t=>this.transpose(t),t=>this.transpose(t),!0)}moveDown(){return this.move(t=>this.transpose(t.map(t=>t.reverse())),t=>this.transpose(t).map(t=>t.reverse()),!0)}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}addCell(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push({r:e,c:s});if(0===t.length)return;let{r:e,c:s}=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}updateUI(){let t=document.querySelectorAll(".field-cell"),e=this.state.flat();t.forEach((t,s)=>{t.className="field-cell";let a=e[s];a>0?(t.textContent=a,t.classList.add(`field-cell--${a}`)):t.textContent=""}),document.querySelector(".game-score").textContent=this.score}checkStatus(){for(let t=0;t<this.state.length;t++)for(let s=0;s<this.state[t].length;s++)if(2048===this.state[t][s]){this.status=e.GAME_STATUS.win;return}let t=!1;for(let e=0;e<this.state.length;e++){for(let s=0;s<this.state[e].length-1;s++)if(this.state[e][s]===this.state[e][s+1]){t=!0;break}if(t)break}for(let e=0;e<this.state.length-1;e++){for(let s=0;s<this.state[e].length;s++)if(this.state[e][s]===this.state[e+1][s]){t=!0;break}if(t)break}this.state.some(t=>t.includes(0))||t||(this.status=e.GAME_STATUS.lose)}areStatesEqual(t,e){for(let s=0;s<t.length;s++)for(let a=0;a<t[s].length;a++)if(t[s][a]!==e[s][a])return!1;return!0}}const s=new(t=e),a={LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown"},r=document.querySelector(".button"),i=document.querySelector(".message-start"),l=document.querySelector(".message-lose"),n=document.querySelector(".message-win"),h=document.querySelector(".game-score"),o=()=>h.textContent=s.getScore();r.addEventListener("click",function(){let t=r.classList.toggle("restart");r.classList.toggle("start"),i.classList.add("hidden"),l.classList.add("hidden"),n.classList.add("hidden"),h.textContent=0,t?(r.textContent="Restart",s.start()):(r.textContent="Start",s.restart()),document.addEventListener("keydown",c)});const u=()=>document.removeEventListener("keydown",c);function c(e){if(s.getStatus()===t.GAME_STATUS.playing){let t=!1;switch(e.key){case a.LEFT:t=s.moveLeft();break;case a.RIGHT:t=s.moveRight();break;case a.UP:t=s.moveUp();break;case a.DOWN:t=s.moveDown()}t&&o()}s.getStatus()===t.GAME_STATUS.lose&&(l.classList.remove("hidden"),u()),s.getStatus()===t.GAME_STATUS.win&&(n.classList.remove("hidden"),u()),e.preventDefault()}
//# sourceMappingURL=index.b7280238.js.map
